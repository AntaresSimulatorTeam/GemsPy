#
# See AUTHORS.txt
#
# This Source Code Form is subject to the terms of the Mozilla Public
# License, v. 2.0. If a copy of the MPL was not distributed with this
# file, You can obtain one at http://mozilla.org/MPL/2.0/.
#
# SPDX-License-Identifier: MPL-2.0
#
# This file is part of the Antares project.

# Configuration file to convert a complex modelling artefact in an Antares study into an Andromede model.

#TODOs :
#*idem pour battery_pcomp

loop: 
    
  iteration-key: area #Key on which we iterate (for a given list of area, we want to execute a loop : for area in list_area)

  andromede-component-id: battery_$area$

  andromede-model: andromede-v1-models.battery

  parameters: 
  
    - id: reservoir_capacity
      time-dependent: false 
      scenario-dependent: false
      value: 
      - cluster: z_batteries_batteries_$area$_1
      - field: nominalcapacity #field in the file "list.ini"
      - multiplication_factor: 1
    - id: injection_nominal_capacity 
      time-dependent: false
      scenario-dependent: false
      value:
      - path: input/links/$area$/capacities/z_batteries_direct.txt
      - column: 0 #To be read in first column
      - operator: max
    - id: withdrawal_nominal_capacity
      time-dependent: false
      scenario-dependent: false
      value: 
      - cluster: $area$_batteries_inj
      - field: nominalcapacity
      - multiplication_factor: 1 #field in the file "list.ini"
    - id: efficiency_injection  
      time-dependent: false  
      scenario-dependent: false  
      value: 
      - binding_constraint: batteries_$area$ 
      - field : $area$%z_batteries   #field in the file corresponding to the binding constraint
      - multiplication_factor: -1
    - id: efficiency_withdrawal
      time-dependent: false
      scenario-dependent: false
      value: 
      - binding_constraint: batteries_$area$ 
      - field : $area$.$area$_batteries_inj  
      - multiplication_factor: 1
    - id: lower_rule_curve
      time-dependent: false
      scenario-dependent: false
      value: 0 
    - id: upper_rule_curve
      time-dependent: true
      scenario-dependent: false
      value: 
      - path: input/thermal/series/z_batteries/z_batteries_batteries_$area$_1/series.txt
      - column: 0 #To be read in first column
      - multiplication_factor: 1.0 /reservoir_capacity #Reference to a constant parameter already defined above.
    - id: p_max_injection_modulation   
      time-dependent: true
      scenario-dependent: false
      value:
      - path: input/links/$area$/capacities/z_batteries_direct.txt
      - column: 0 #To be read in first column
      - multiplication_factor: 1.0 / injection_nominal_capacity #Reference to a constant parameter already defined above.
    - id: p_max_withdrawal_modulation
      time-dependent: true
      scenario-dependent: false
      value:  
      - path: input/thermal/series/$area$/$area$_batteries_inj/series.txt
      - column: 0 #To be read in first column
      - multiplication_factor: 1.0 / withdrawal_nominal_capacity #Reference to a constant parameter already defined above.
    - id: marginal_cost
      time-dependent: true
      scenario-dependent: false
      value:
      - path: input/links/$area$/capacities/z_batteries_parameters
      - column: 0 #To be read in first column (direct hurdle costs)
      - multiplication_factor: 1.0


  area-connections: #Syntax for hybrid connections: https://antares-simulator.readthedocs.io/en/latest/user-guide/solver/08-hybrid-studies/
  #To handle the case of hybrid studies, where we replace complex modeling artifacts for batteries by a model.
  #TODO : handle the case of pure Andromede studies
    -  component: battery_$area$
       port: injection_port
       area: $area$

  legacy-objects-to-delete:
    - binding_constraints:
      - id : batteries_$area$
      - id : battery_level_$area$
    - links: 
      - id : $area$%z_batteries
    - nodes:
      - id : z_batteries #Warning: does not depend on area
    - thermal_clusters:
      - id : $area$.$area$_batteries_inj
      - id : z_batteries.z_batteries_batteries_$area$_1
      - id : z_batteries.z_batteries_batteries_$area$_2
